From fc2c1ca8b710c4ed99acb693e3f26fc617104d48 Mon Sep 17 00:00:00 2001
From: Mattias Waldo <mattias.waldo@saabgroup.com>
Date: Thu, 4 Feb 2021 07:29:07 +0000
Subject: [PATCH] Remove absolute paths to avoid build host contamination.

---
 configure.ac                                   | 8 ++++----
 platforms/delta-bf/cp2112_util/Makefile.am     | 2 +-
 platforms/delta-bf/tofino_spi_util/Makefile.am | 2 +-
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/configure.ac b/configure.ac
index ac662ab..268d511 100644
--- a/configure.ac
+++ b/configure.ac
@@ -77,7 +77,7 @@ AM_CONDITIONAL([WITH_TOFINO], [test "$want_tofino" = yes])
 build_for_asic_or_model=
 AC_ARG_WITH([model],
     AS_HELP_STRING([--with-model], ["Build for the software asic model"]),
-    [build_for_asic_or_model=model], 
+    [build_for_asic_or_model=model],
     [build_for_asic_or_model=asic])
 AM_CONDITIONAL([IS_ASIC], [test "x$build_for_asic_or_model" = xasic])
 
@@ -127,10 +127,10 @@ AC_SUBST([PREFIX_PATH], ["$(if test x$prefix != xNONE; then \
                            )"])
 export PREFIX_PATH
 AC_SUBST([BFPLATFORMS_CFLAGS], ["-g -Wall -Wextra -Wpedantic -Wno-missing-field-initializers -Wno-unused-parameter"])
-AC_SUBST([AM_CFLAGS], ["$COVERAGE_FLAGS $ASAN_FLAGS -I$PREFIX_PATH/include"])
-AC_SUBST([AM_CXXFLAGS], ["$COVERAGE_FLAGS $ASAN_FLAGS -I$PREFIX_PATH/include"])
+AC_SUBST([AM_CFLAGS], ["$COVERAGE_FLAGS $ASAN_FLAGS "])
+AC_SUBST([AM_CXXFLAGS], ["$COVERAGE_FLAGS $ASAN_FLAGS "])
 AC_SUBST([AM_CPPFLAGS], ["$MY_CPPFLAGS -I\$(top_srcdir)/drivers/include -I\$(top_srcdir)/platforms/include -I\$(top_srcdir)/platforms/delta-bf/tcl_server/include"])
-AC_SUBST([AM_LDFLAGS], ["$COVERAGE_FLAGS -L$LIB_DIR"])
+AC_SUBST([AM_LDFLAGS], ["$COVERAGE_FLAGS"])
 AC_SUBST([MY_PYTHONPATH], ["$PYTHON_DIR"])
 
 AC_CHECK_LIB([pthread], [pthread_create], [],
diff --git a/platforms/delta-bf/cp2112_util/Makefile.am b/platforms/delta-bf/cp2112_util/Makefile.am
index ba99352..925d7a9 100644
--- a/platforms/delta-bf/cp2112_util/Makefile.am
+++ b/platforms/delta-bf/cp2112_util/Makefile.am
@@ -1,6 +1,6 @@
 bin_PROGRAMS = cp2112_util
 cp2112_util_CFLAGS = $(AM_CFLAGS) $(BFPLATFORMS_CFLAGS)
-cp2112_util_CPPFLAGS = -I$(includedir) -I$(top_srcdir)/drivers/include/ -I$(top_srcdir)/platforms/include -I$(top_srcdir)/platforms/accton-bf/include/ -DDEVICE_IS_ASIC
+cp2112_util_CPPFLAGS = -I$(top_srcdir)/drivers/include/ -I$(top_srcdir)/platforms/include -I$(top_srcdir)/platforms/accton-bf/include/ -DDEVICE_IS_ASIC
 
 cp2112_util_SOURCES = \
 cp2112_util.c \
diff --git a/platforms/delta-bf/tofino_spi_util/Makefile.am b/platforms/delta-bf/tofino_spi_util/Makefile.am
index fe93005..e5e25d1 100644
--- a/platforms/delta-bf/tofino_spi_util/Makefile.am
+++ b/platforms/delta-bf/tofino_spi_util/Makefile.am
@@ -1,6 +1,6 @@
 bin_PROGRAMS = spi_i2c_util
 spi_i2c_util_CFLAGS = $(AM_CFLAGS) $(BFPLATFORMS_CFLAGS)
-spi_i2c_util_CPPFLAGS = -I$(includedir) -I$(top_srcdir)/drivers/include/ -I$(top_srcdir)/platforms/include -I$(top_srcdir)/platforms/delta-bf/include/ -DDEVICE_IS_ASIC
+spi_i2c_util_CPPFLAGS = -I$(top_srcdir)/drivers/include/ -I$(top_srcdir)/platforms/include -I$(top_srcdir)/platforms/delta-bf/include/ -DDEVICE_IS_ASIC
 
 spi_i2c_util_SOURCES = \
 tofino_spi_if.c \
